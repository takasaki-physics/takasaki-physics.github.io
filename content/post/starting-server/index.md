---
title: サーバー作ろう
description: サーバーの設定とか
slug: starting-server
date: 2023-10-05
categories: 
    - サーバー研究会
tags: 
    - Linux
---

注: サーバー研究会の文章は基本的に、専門用語などを多用するので、あまり初心者向けではありません。適宜調べながら読んでいただくとより理解を深めることができると思います。

# 物理部サーバー構築について
## 経緯
先生が「サーバーが欲しい」と言っていたため、なんとなくサーバーが作れないか試してみることにしました。

## 機材
物理部には昔からあるパソコンがあるので、それのOSを入れ替えてサーバーにすることにしました。
そういえば、物理部にはRasberry Piもあるので、そちらに変えるかも知れません。
(Rasberry piの存在はすっかり忘れていました。)

現状のスペック:
```
OS: Windows10 21H2
CPU: Intel core iシリーズ(詳細は忘れました)
GPU: Radeonシリーズ(詳細は忘れました)
RAM: 8GBx2枚?

SSD: 256GB程度?
HDD: 400GB程度?
```
Windowsはやや古いバージョンがインストールされていますね。OSは入れ直すので特に関係ありませんが。

## 技術解説
とりあえず、OSはサーバー向けのFedora38を試してみたいと思います。
(Ubuntu Serverとかに変えるかも知れませんが、とりあえずはこれで試験動作とかを行います。)

デスクトップ環境は、KDEを使用します。
(理由: 自分がKDE信者なので。
あと、CUIだとメンテナンスがしにくいと思ったので。)

先生が作って欲しいのは多分APIサーバーなので、そのAPI部分はC#で構築する予定です。
(理由: 自分がC#が好きなので。)

仮の目標としては、物理部内で使えること、つまりは外部公開はすぐにはしない予定なので、ドメインは不要かと考えています。(公開IPアドレスで直接アクセスするということ。)
高崎高校のサブドメインは貸してもらえないと思いますが、翠巒祭のサブドメインなら貸してもらえるかも知れないので少し期待しています。

DDoS攻撃対策や、セキュリティー対策などの設定は面倒なので、先述の通り内部向け公開とします。

運用に関しては、24時間稼働ではなく、物理部の活動が始まる前後の時間からBiosを通じて起動/シャットダウンを自動的に行えないかと考えています。

細かい技術や運用方法に関しては、実際にサーバーを触りながら決めていくので、今はこれくらいのぼんやりとした高層のまま進めていきます。

## OSのインストール
さて、早速OSを入れていきましょう。<br />
今回はFedoraですね。<br />

OSの書き込みはFedora公式から配布されているFedora Media Writerを使います。<br />

### 問題発生
**画面がバグる**<br />
さて、早速入れてみたわけですが、問題が発生しました。<br />
そう、画面の表示が正常に行われないのです。<br />
起動してすぐはちゃんと表示されているのですが、数分立つと画面の表示がおかしくなり、マウスカーソルも動かなくなります。<br />

原因を究明するために様々な環境で検証を行いました。

<details>

- Fedora KDE(Fedora38) - Fedora Media Writer
初めの方は正常に動作していて、USB Live内にインストールされているソフトウェアでWindowsが入っていたハードディスクのパーティション削除と、数独ゲームを遊ぶことができていました。
しかし、OSのインストール準備を開始すると、画面の表示がおかしくなり始め、マウスカーソルも動作せずに使うことが出来なくなりました。
この時点では、USB内のOSデータが破損している可能性が高いと考えて、もう一度試すことにしました。

- Fedora KDE(Fedora38) - Fedora Media Writer(2回目)
ということで、試してみたのですが、同様のエラーになりました。
(今回は起動してすぐに画面が崩れました。)
Fedora側のエラー(Fedora38はbeta版ではなく、安定版なので、PCとの相性問題)の可能性があると考えて、Ubuntu系のOSを試してみることにしました。

- KDE Neon - Fedora Media Writer
こちらも同様にエラー。
OSをUSBに書き込んでいるソフトウェア(Fedora Media Writer)の問題の可能性もあるので、Rufusを試すことにしました。

- Fedora KDE(Fedora38) - Rufus
こちらも同様にエラー。
ここで書き込みソフトの問題ではないと確信しました。
続いて、DE(KDE)によるエラーと考え、GNOME版のFedoraを試すことにしてみました。

- Fedora(Fedora38) - Fedora Media Writer
こちらは、公式による安定版なので、インストールでき、実際にこれで稼働するか…と思った瞬間に画面エラーが発生しました。
インストール自体は成功していますが、数分で画面エラーとなるため、まともに使えません。

と、ここで夜になってしまったのでこの日の検証は終了しました。<br />
(4時間程度かけましたが、結局インストールはできませんでした。)<br />
</details>

以上の数回に及ぶ検証の元導き出せた答えは以下のとおりです。
- OS書き込みソフトの問題ではない。
- FedoraやUbuntuといったOSの問題でもない。
- KDEやGNOMEといったDEの問題でもない。
- Windowsが入っていたときは画面のエラーには1回もならなかったので、PCが破損している可能性は極めて低い。

さて、重要なことに気がつきました。<br />
家で風呂に入っているときに気がついたのですが、<br />
**あのPCのGPU、Radeonじゃね???**

そう、それなら画面のエラーが生じている説明がつきます。
- Windowsでは正常に動作がするのに、今回(Linux)は正常に動作しない<br />
WindowsにはRadeonのドライバがインストールされていましたが、Linuxではドライバのインストールを行っていなかったためだと考えられます。<br />
(GeforceよりもRadeonのほうが利用者が少なく、ドライバも基本的にGeforce向けに作られていたりが多いのではないかと考えられます。<br />
また、おそらくあのRadeonのグラボは古いものなのでドライバが入っていない可能性は高いです。)<br />

- 画面のエラー<br />
そもそも、システム的なエラーだったらLinuxコミュニティーで問題になってすぐに修正されるはずです。<br />
また、OS的にもDE的にも正常に動作していないものを正規リリースとしているわけがないです。<br />

今までの細かな検証のおかげで、この事実に気づけました。<br />
(検証によってソフトウェア的なエラーではなく、ハードウェア的な問題だと気づけました。)<br />
(というか、自分で言うのもあれですが、原因がRadeonだとよく気づいたなと思います(笑))<br />

こちらの解決方法に関しては、CPUに内蔵GPUがあれば(あるはずなので)それから画面出力をするという方法です。<br />
(もし内蔵GPUがなかったら対応が難しいので、Rasberry piに切り替えます。)<br />
(内蔵CPU動作のときにドライバを入れておけば、あとからRadeonのグラボを使うことができるるようになります。)<br />

#### OSに関して
実際の環境ならUbuntu Serverとかもありかもしれません。<br />
FedoraとUbuntuの基本的な違いはUbuntuでは```apt```を、Fedoraでは```yum```を使うくらいです。<br />
他にも(内部とか)違いはあると思いますが、とりあえずこれを覚えておけば大丈夫です。<br />

## .NET SDK
APIサーバーとしての利用を行いたいので、今回はC#の環境を準備します。<br />

最新のUbuntuでは、```dotnet```が標準搭載されていますが、Fedoraは標準搭載されていないはずなので、Microsoft公式サイトからダウンロードします。<br />

## 目標
そういえば、ここまでサーバー研究会の目標についてあまり触れていなかったので、それについて少し触れていきます。<br />
先述の通り、詳細についてはサーバーをいじりながら決めていきます。

全部はやらないと思いますが、一応参考としてのせておきます。
- API鯖
    - curlレスポンス
    - 入力に応じて出力を変える。
    ↑これを応用したらML.NETを使ってAI鯖がすぐ作れるかと思います。
- SNS鯖
<br />課題研究でSNS系を提案したグループにインフラを提供します。
    - misskey鯖(いらない)
    - matrix鯖
    現在使っている物理部で使用しているSlackだと、会話などの履歴が残らなくて困ることがあるので設置したいと考えています。
    - GitLab鯖
    まあ、GitHubでもいいのですが、秘密データなどの保管ができるように設置できたら便利かもしれません。普通にNASみたいにしてもいいですが。
